

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Basic Functions &#8212; MacroDensity</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'doctests/MDTutorials_1';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Heterojunction offsets" href="HeteroJunction/HeteroJunction.html" />
    <link rel="prev" title="Tutorials" href="../tutorials.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    <p class="title logo__title">MacroDensity</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Welcome to MacroDensity
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../modules.html">Python API</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../macrodensity.html">MacroDensity Package</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../macrodensity.alpha.html">macrodensity.alpha module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../macrodensity.density.html">macrodensity.density module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../macrodensity.plotting.html">macrodensity.plotting module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../macrodensity.io.html">macrodensity.io module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../macrodensity.utils.html">macrodensity.utils module</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../tutorials.html">Tutorials</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Basic Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="HeteroJunction/HeteroJunction.html">Heterojunction offsets</a></li>
<li class="toctree-l2"><a class="reference internal" href="Plotting/Plotting.html">Band Alignment Plotting Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="Porous/Porous.html">Ionisation potential of a porous material</a></li>
<li class="toctree-l2"><a class="reference internal" href="Slab/SlabCalculation.html">Ionisation potential of a bulk material</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../studies.html">Studies using MacroDensity</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/WMD-group/MacroDensity" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/doctests/MDTutorials_1.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Basic Functions</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-the-planar-and-macroscopic-average">Finding the planar and macroscopic average</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-the-potential">Get the potential</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-a-planar-average-field-potential-throughout-the-material">Plotting a planar average (Field/potential) throughout the material</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#distinguishing-plateau-regions-in-the-electrostatic-potential">Distinguishing plateau regions in the electrostatic potential</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#initialising-inputs">Initialising inputs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-potential-values">Getting potential values</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distinguishing-between-vaccuum-and-non-vaccuum-cubes">Distinguishing between vaccuum and non-vaccuum cubes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aligning-band-edged-to-reference-potentials">Aligning band edged to reference potentials</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#input-section">Input Section</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-potential-values-and-band-edges">Getting potential values and band edges</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-reference-states-and-the-aligned-band-energies">Calculating reference states and the aligned band energies</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-variation-of-potential-and-magnitude-of-electric-field">Plotting variation of potential and magnitude of electric field</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Initialising inputs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-the-potentials-and-field-magnitudes">Getting the potentials and field magnitudes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-the-data-into-a-csv-and-dat-binary-file">Saving the data into a .csv and .dat (binary file)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#moving-cube">Moving Cube</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Input section</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-the-potential-values-along-a-vector">Getting the potential values along a vector</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-and-saving-the-graph">Plotting and Saving the graph</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-and-inputs">Imports and Inputs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-and-calculating-potentials">Getting and calculating potentials</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-and-saving-potentials">Plotting and saving potentials</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-the-planar-average">Calculating the Planar Average</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-and-input-section">Imports and Input Section</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-potentials-from-vasp-file">Getting Potentials from VASP file</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-planar-and-macroscopic-average">Calculating planar and macroscopic average</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-and-saving">Plotting and Saving</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-the-planar-and-macroscopic-averages-from-a-cube-file">Calculating the planar and macroscopic averages from a .cube file</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-potentials-from-cube-file">Reading potentials from .cube file</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Calculating planar and macroscopic average</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Plotting and Saving</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-the-spherical-average-around-a-given-point-in-a-material">Calculating the Spherical Average around a given point in a material</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Input Section</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-potential-and-printing-the-potential-and-variance-values">Getting potential and printing the potential and variance values</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="basic-functions">
<h1>Basic Functions<a class="headerlink" href="#basic-functions" title="Permalink to this heading">#</a></h1>
<p>Welcome to MacroDensity’s tutorial Jupyter Notebook. This notebook contains a few examples of how MacroDensity’s basic functions are used. By downloading the package, you have access to the executable Jupyter Notebook.</p>
<section id="finding-the-planar-and-macroscopic-average">
<h2>Finding the planar and macroscopic average<a class="headerlink" href="#finding-the-planar-and-macroscopic-average" title="Permalink to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">MacroDensity</span></code> is able to calculate the planar and macroscopic potential average of a material. The code below illustrates that:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">macrodensity</span> <span class="k">as</span> <span class="nn">md</span>
</pre></div>
</div>
</div>
</div>
<section id="get-the-potential">
<h3>Get the potential<a class="headerlink" href="#get-the-potential" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read density data from CHGCAR.test</span>
<span class="n">vasp_pot</span><span class="p">,</span> <span class="n">NGX</span><span class="p">,</span> <span class="n">NGY</span><span class="p">,</span> <span class="n">NGZ</span><span class="p">,</span> <span class="n">Lattice</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">read_vasp_density</span><span class="p">(</span><span class="s1">&#39;CHGCAR.test&#39;</span><span class="p">)</span>
<span class="n">vector_a</span><span class="p">,</span><span class="n">vector_b</span><span class="p">,</span><span class="n">vector_c</span><span class="p">,</span><span class="n">av</span><span class="p">,</span><span class="n">bv</span><span class="p">,</span><span class="n">cv</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">matrix_2_abc</span><span class="p">(</span><span class="n">Lattice</span><span class="p">)</span>
<span class="n">resolution_x</span> <span class="o">=</span> <span class="n">vector_a</span> <span class="o">/</span> <span class="n">NGX</span>
<span class="n">resolution_y</span> <span class="o">=</span> <span class="n">vector_b</span> <span class="o">/</span> <span class="n">NGY</span>
<span class="n">resolution_z</span> <span class="o">=</span> <span class="n">vector_c</span> <span class="o">/</span> <span class="n">NGZ</span>

<span class="c1"># Convert potential data to a grid and get the total number of electrons</span>
<span class="n">grid_pot</span><span class="p">,</span> <span class="n">electrons</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">density_2_grid</span><span class="p">(</span><span class="n">vasp_pot</span><span class="p">,</span> <span class="n">NGX</span><span class="p">,</span> <span class="n">NGY</span><span class="p">,</span> <span class="n">NGZ</span><span class="p">)</span>
<span class="n">cutoff_varience</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c1"># Get the gradients (Field) if required. Comment out if not required due to computational expense.</span>
<span class="n">grad_x</span><span class="p">,</span> <span class="n">grad_y</span><span class="p">,</span> <span class="n">grad_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">grid_pot</span><span class="p">[:,:,:],</span> <span class="n">resolution_x</span><span class="p">,</span> <span class="n">resolution_y</span><span class="p">,</span> <span class="n">resolution_z</span><span class="p">)</span>

<span class="c1"># Convert fractional points to grid points on the density surface</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">numbers_2_grid</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">NGX</span><span class="p">,</span> <span class="n">NGY</span><span class="p">,</span> <span class="n">NGZ</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">numbers_2_grid</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">NGX</span><span class="p">,</span> <span class="n">NGY</span><span class="p">,</span> <span class="n">NGZ</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">numbers_2_grid</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">NGX</span><span class="p">,</span> <span class="n">NGY</span><span class="p">,</span> <span class="n">NGZ</span><span class="p">)</span>

<span class="c1"># Calculate the coefficients of the plane defined by the three points</span>
<span class="n">plane_coeff</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">points_2_plane</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">plane_coeff</span><span class="p">)</span>

<span class="c1"># Get the gradients</span>
<span class="n">XY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">grad_x</span><span class="p">,</span> <span class="n">grad_y</span><span class="p">)</span>
<span class="n">grad_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">XY</span><span class="p">,</span> <span class="n">grad_z</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reading header information...
Reading 3D data using Pandas...
Average of the potential =  8.000000069794417
[-3136.     0.  3136.    -0.]
</pre></div>
</div>
</div>
</div>
</section>
<section id="plotting-a-planar-average-field-potential-throughout-the-material">
<h3>Plotting a planar average (Field/potential) throughout the material<a class="headerlink" href="#plotting-a-planar-average-field-potential-throughout-the-material" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate planar average for the gradients (FIELDS)</span>
<span class="n">planar_gradients</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">planar_average</span><span class="p">(</span><span class="n">grad_x</span><span class="p">,</span> <span class="n">NGX</span><span class="p">,</span> <span class="n">NGY</span><span class="p">,</span> <span class="n">NGZ</span><span class="p">)</span>

<span class="c1"># Calculate planar average for the potential</span>
<span class="n">planar_potential</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">planar_average</span><span class="p">(</span><span class="n">grid_pot</span><span class="p">,</span> <span class="n">NGX</span><span class="p">,</span> <span class="n">NGY</span><span class="p">,</span> <span class="n">NGZ</span><span class="p">)</span>

<span class="c1"># Calculate macroscopic average using the planar average and other parameters</span>
<span class="n">macro_average</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">macroscopic_average</span><span class="p">(</span><span class="n">planar_potential</span><span class="p">,</span> <span class="mf">4.80</span><span class="p">,</span> <span class="n">resolution_z</span><span class="p">)</span>

<span class="c1"># Plotting the planar average and macroscopic average</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">planar_gradients</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Planar Gradient&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">planar_potential</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Planar Potential&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">macro_average</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Macroscopic Average&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;Planar.eps&#39;</span><span class="p">)</span>  <span class="c1"># Save the figure as EPS</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Average of the average =  7.72953392288895
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The PostScript backend does not support transparency; partially transparent artists will be rendered opaque.
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/45c8dd95f9f46eba3b8aaac5d4dd76226c2433be1e47a79d9b9bd145f05220c5.png"><img alt="../_images/45c8dd95f9f46eba3b8aaac5d4dd76226c2433be1e47a79d9b9bd145f05220c5.png" src="../_images/45c8dd95f9f46eba3b8aaac5d4dd76226c2433be1e47a79d9b9bd145f05220c5.png" style="height: 300px;" /></a>
</div>
</div>
</section>
</section>
<section id="distinguishing-plateau-regions-in-the-electrostatic-potential">
<h2>Distinguishing plateau regions in the electrostatic potential<a class="headerlink" href="#distinguishing-plateau-regions-in-the-electrostatic-potential" title="Permalink to this heading">#</a></h2>
<p>The code below aims to detect plateau regions in the electrostatic potential of a material. It takes inputs such as cube size, cube origin in fractional unit cell coordinates, a tolerance threshold for identifying plateaus, and an input VASP LOCPOT filename. The output is the percentage of cubes categorized as non-vacuum versus vacuum, providing insight into areas of consistent potential within the material.</p>
<section id="initialising-inputs">
<h3>Initialising inputs<a class="headerlink" href="#initialising-inputs" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cube_size</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">cube_origin</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">]</span>
<span class="n">tolerance</span> <span class="o">=</span> <span class="mf">1E-4</span>
<span class="n">input_file</span> <span class="o">=</span> <span class="s1">&#39;LOCPOT.test&#39;</span> 
</pre></div>
</div>
</div>
</div>
</section>
<section id="getting-potential-values">
<h3>Getting potential values<a class="headerlink" href="#getting-potential-values" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vasp_pot</span><span class="p">,</span> <span class="n">NGX</span><span class="p">,</span> <span class="n">NGY</span><span class="p">,</span> <span class="n">NGZ</span><span class="p">,</span> <span class="n">Lattice</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">read_vasp_density</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
<span class="n">vector_a</span><span class="p">,</span><span class="n">vector_b</span><span class="p">,</span><span class="n">vector_c</span><span class="p">,</span><span class="n">av</span><span class="p">,</span><span class="n">bv</span><span class="p">,</span><span class="n">cv</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">matrix_2_abc</span><span class="p">(</span><span class="n">Lattice</span><span class="p">)</span>
<span class="n">resolution_x</span> <span class="o">=</span> <span class="n">vector_a</span><span class="o">/</span><span class="n">NGX</span>
<span class="n">resolution_y</span> <span class="o">=</span> <span class="n">vector_b</span><span class="o">/</span><span class="n">NGY</span>
<span class="n">resolution_z</span> <span class="o">=</span> <span class="n">vector_c</span><span class="o">/</span><span class="n">NGZ</span>
<span class="n">grid_pot</span><span class="p">,</span> <span class="n">electrons</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">density_2_grid</span><span class="p">(</span><span class="n">vasp_pot</span><span class="p">,</span><span class="n">NGX</span><span class="p">,</span><span class="n">NGY</span><span class="p">,</span><span class="n">NGZ</span><span class="p">)</span>
<span class="n">cutoff_varience</span> <span class="o">=</span> <span class="n">tolerance</span>
<span class="n">grad_x</span><span class="p">,</span><span class="n">grad_y</span><span class="p">,</span><span class="n">grad_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">grid_pot</span><span class="p">[:,:,:],</span><span class="n">resolution_x</span><span class="p">,</span><span class="n">resolution_y</span><span class="p">,</span><span class="n">resolution_z</span><span class="p">)</span>
<span class="n">travelled</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reading header information...
Reading 3D data using Pandas...
Average of the potential =  -4.0478731477833207e-13
</pre></div>
</div>
</div>
</div>
</section>
<section id="distinguishing-between-vaccuum-and-non-vaccuum-cubes">
<h3>Distinguishing between vaccuum and non-vaccuum cubes<a class="headerlink" href="#distinguishing-between-vaccuum-and-non-vaccuum-cubes" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vacuum</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">non_vacuum</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NGX</span><span class="p">,</span><span class="n">cube_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NGY</span><span class="p">,</span><span class="n">cube_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NGZ</span><span class="p">,</span><span class="n">cube_size</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
            <span class="n">sub_origin</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="n">NGX</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">/</span><span class="n">NGY</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="n">NGZ</span><span class="p">]</span>
            <span class="n">cube_pot</span><span class="p">,</span> <span class="n">cube_var</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">volume_average</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="n">sub_origin</span><span class="p">,</span><span class="n">cube</span><span class="o">=</span><span class="n">cube_size</span><span class="p">,</span><span class="n">grid</span><span class="o">=</span><span class="n">grid_pot</span><span class="p">,</span><span class="n">nx</span><span class="o">=</span><span class="n">NGX</span><span class="p">,</span><span class="n">ny</span><span class="o">=</span><span class="n">NGY</span><span class="p">,</span><span class="n">nz</span><span class="o">=</span><span class="n">NGZ</span><span class="p">,</span><span class="n">travelled</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">cube_var</span> <span class="o">&lt;=</span> <span class="n">cutoff_varience</span><span class="p">:</span>
                <span class="n">vacuum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_origin</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">non_vacuum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_origin</span><span class="p">)</span>
                
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of vacuum cubes: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">vacuum</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of non-vacuum cubes: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">non_vacuum</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Percentage of vacuum cubes: &quot;</span><span class="p">,(</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vacuum</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vacuum</span><span class="p">))</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">non_vacuum</span><span class="p">)))</span><span class="o">*</span><span class="mf">100.</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Percentage of non-vacuum cubes: &quot;</span><span class="p">,(</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">non_vacuum</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vacuum</span><span class="p">))</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">non_vacuum</span><span class="p">)))</span><span class="o">*</span><span class="mf">100.</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of vacuum cubes:  17
Number of non-vacuum cubes:  4079
Percentage of vacuum cubes:  0.4150390625
Percentage of non-vacuum cubes:  99.5849609375
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="aligning-band-edged-to-reference-potentials">
<h2>Aligning band edged to reference potentials<a class="headerlink" href="#aligning-band-edged-to-reference-potentials" title="Permalink to this heading">#</a></h2>
<p>The code below deals with aligning band edges to the reference potential within interstitial regions of a material. Input parameters include the positions of interstitial spaces, the VASP OUTCAR and LOCPOT filenames, and the size of a cube defined by LOCPOT FFT mesh points. The function’s output consists of the aligned valence band, aligned conduction band, and variances within the interstitial regions.</p>
<section id="input-section">
<h3>Input Section<a class="headerlink" href="#input-section" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interstices</span> <span class="o">=</span> <span class="p">([</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],[</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.25</span><span class="p">])</span> <span class="c1">#(POINT: typo error here)</span>
<span class="n">outcar</span> <span class="o">=</span> <span class="s1">&#39;OUTCAR.test&#39;</span>
<span class="n">locpot</span> <span class="o">=</span> <span class="s1">&#39;LOCPOT.test&#39;</span>
<span class="n">cube_size</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="getting-potential-values-and-band-edges">
<h3>Getting potential values and band edges<a class="headerlink" href="#getting-potential-values-and-band-edges" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># GETTING POTENTIAL</span>
<span class="n">vasp_pot</span><span class="p">,</span> <span class="n">NGX</span><span class="p">,</span> <span class="n">NGY</span><span class="p">,</span> <span class="n">NGZ</span><span class="p">,</span> <span class="n">Lattice</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">read_vasp_density</span><span class="p">(</span><span class="n">locpot</span><span class="p">,</span><span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">vector_a</span><span class="p">,</span><span class="n">vector_b</span><span class="p">,</span><span class="n">vector_c</span><span class="p">,</span><span class="n">av</span><span class="p">,</span><span class="n">bv</span><span class="p">,</span><span class="n">cv</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">matrix_2_abc</span><span class="p">(</span><span class="n">Lattice</span><span class="p">)</span>
<span class="n">resolution_x</span> <span class="o">=</span> <span class="n">vector_a</span><span class="o">/</span><span class="n">NGX</span>
<span class="n">resolution_y</span> <span class="o">=</span> <span class="n">vector_b</span><span class="o">/</span><span class="n">NGY</span>
<span class="n">resolution_z</span> <span class="o">=</span> <span class="n">vector_c</span><span class="o">/</span><span class="n">NGZ</span>
<span class="n">grid_pot</span><span class="p">,</span> <span class="n">electrons</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">density_2_grid</span><span class="p">(</span><span class="n">vasp_pot</span><span class="p">,</span><span class="n">NGX</span><span class="p">,</span><span class="n">NGY</span><span class="p">,</span><span class="n">NGZ</span><span class="p">)</span>

<span class="c1"># GETTING BAND EDGES</span>
<span class="n">band_extrema</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">get_band_extrema</span><span class="p">(</span><span class="n">outcar</span><span class="p">)</span>
<span class="n">VB_eigenvalue</span> <span class="o">=</span> <span class="n">band_extrema</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">CB_eigenvalue</span> <span class="o">=</span> <span class="n">band_extrema</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reading header information...
Reading 3D data using Pandas...
</pre></div>
</div>
</div>
</div>
</section>
<section id="calculating-reference-states-and-the-aligned-band-energies">
<h3>Calculating reference states and the aligned band energies<a class="headerlink" href="#calculating-reference-states-and-the-aligned-band-energies" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## CALCULATING REFERENCE STATE</span>
<span class="n">interstitial_potentials</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">interstitial_variances</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">interstice</span> <span class="ow">in</span> <span class="n">interstices</span><span class="p">:</span>
    <span class="n">locpot_extract</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">volume_average</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="n">interstice</span><span class="p">,</span><span class="n">cube</span><span class="o">=</span><span class="n">cube_size</span><span class="p">,</span><span class="n">grid</span><span class="o">=</span><span class="n">grid_pot</span><span class="p">,</span><span class="n">nx</span><span class="o">=</span><span class="n">NGX</span><span class="p">,</span><span class="n">ny</span><span class="o">=</span><span class="n">NGY</span><span class="p">,</span><span class="n">nz</span><span class="o">=</span><span class="n">NGZ</span><span class="p">)</span>
    <span class="n">interstitial_potentials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">locpot_extract</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">interstitial_variances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">locpot_extract</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1">## CALCULATING ALIGNED BAND ENERGIES</span>
<span class="n">sum_interstitial_potential</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">interstitial_potentials</span><span class="p">:</span>
    <span class="n">sum_interstitial_potential</span> <span class="o">+=</span> <span class="n">ele</span>
<span class="n">average_interstitial_potential</span> <span class="o">=</span> <span class="n">sum_interstitial_potential</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">interstitial_potentials</span><span class="p">)</span>
<span class="n">VB_aligned</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">VB_eigenvalue</span> <span class="o">-</span> <span class="n">average_interstitial_potential</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">CB_aligned</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">CB_eigenvalue</span> <span class="o">-</span> <span class="n">average_interstitial_potential</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">## PRINTING</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading band edges from file: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">outcar</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading potential from file: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">locpot</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Interstital variances: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">interstitial_variances</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VB_aligned (eV)      CB_aligned (eV)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">VB_aligned</span><span class="p">,</span><span class="s2">&quot;         &quot;</span><span class="p">,</span><span class="n">CB_aligned</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reading band edges from file: OUTCAR.test
Reading potential from file: LOCPOT.test
Interstital variances: [1.8665165271901357e-05, 6.277207757909537e-06]
VB_aligned (eV)      CB_aligned (eV)
--------------------------------
-3.24           -1.72
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="plotting-variation-of-potential-and-magnitude-of-electric-field">
<h2>Plotting variation of potential and magnitude of electric field<a class="headerlink" href="#plotting-variation-of-potential-and-magnitude-of-electric-field" title="Permalink to this heading">#</a></h2>
<p>The provided code processes VASP-calculated electrostatic potential and field magnitude data. It reads potential and lattice vectors from a file, calculates gradients, and analyzes a specified cubic region. Depending on the choice, it plots potential against abscissa or field magnitude against abscissa using Matplotlib. The plotted data can be saved to ‘ElectricField.csv’, and additionally, the field magnitude data is stored in binary format as ‘ElectricField.dat’.</p>
<section id="id1">
<h3>Initialising inputs<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">csv</span> 

<span class="c1"># Get the potential and the lattice vectors</span>
<span class="n">vasp_pot</span><span class="p">,</span> <span class="n">NGX</span><span class="p">,</span> <span class="n">NGY</span><span class="p">,</span> <span class="n">NGZ</span><span class="p">,</span> <span class="n">Lattice</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">read_vasp_density</span><span class="p">(</span><span class="s1">&#39;LOCPOT.test&#39;</span><span class="p">)</span>
<span class="n">vector_a</span><span class="p">,</span><span class="n">vector_b</span><span class="p">,</span><span class="n">vector_c</span><span class="p">,</span><span class="n">av</span><span class="p">,</span><span class="n">bv</span><span class="p">,</span><span class="n">cv</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">matrix_2_abc</span><span class="p">(</span><span class="n">Lattice</span><span class="p">)</span>
<span class="n">resolution_x</span> <span class="o">=</span> <span class="n">vector_a</span><span class="o">/</span><span class="n">NGX</span>
<span class="n">resolution_y</span> <span class="o">=</span> <span class="n">vector_b</span><span class="o">/</span><span class="n">NGY</span>
<span class="n">resolution_z</span> <span class="o">=</span> <span class="n">vector_c</span><span class="o">/</span><span class="n">NGZ</span>
<span class="n">grid_pot</span><span class="p">,</span> <span class="n">electrons</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">density_2_grid</span><span class="p">(</span><span class="n">vasp_pot</span><span class="p">,</span><span class="n">NGX</span><span class="p">,</span><span class="n">NGY</span><span class="p">,</span><span class="n">NGZ</span><span class="p">)</span>
<span class="n">grad_x</span><span class="p">,</span><span class="n">grad_y</span><span class="p">,</span><span class="n">grad_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">grid_pot</span><span class="p">[:,:,:],</span><span class="n">resolution_x</span><span class="p">,</span><span class="n">resolution_y</span><span class="p">,</span><span class="n">resolution_z</span><span class="p">)</span>

<span class="n">cube</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">vector</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">origin</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">]</span>
<span class="n">magnitude</span> <span class="o">=</span> <span class="mi">280</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reading header information...
Reading 3D data using Pandas...
Average of the potential =  -4.0478731477833207e-13
</pre></div>
</div>
</div>
</div>
</section>
<section id="getting-the-potentials-and-field-magnitudes">
<h3>Getting the potentials and field magnitudes<a class="headerlink" href="#getting-the-potentials-and-field-magnitudes" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Getting the potential and plotting it</span>
<span class="n">cubes_potential</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">travelling_volume_average</span><span class="p">(</span><span class="n">grid_pot</span><span class="p">,</span><span class="n">cube</span><span class="p">,</span><span class="n">origin</span><span class="p">,</span><span class="n">vector</span><span class="p">,</span><span class="n">NGX</span><span class="p">,</span><span class="n">NGY</span><span class="p">,</span><span class="n">NGZ</span><span class="p">,</span><span class="n">magnitude</span><span class="p">)</span>
<span class="n">abscissa</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">vector_2_abscissa</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span><span class="n">magnitude</span><span class="p">,</span><span class="n">resolution_x</span><span class="p">,</span><span class="n">resolution_y</span><span class="p">,</span><span class="n">resolution_z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">abscissa</span><span class="p">,</span> <span class="n">cubes_potential</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$z (\AA)$&quot;</span><span class="p">)</span>


<span class="c1">## Getting the field and plotting it</span>
<span class="n">grad_mag</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">gradient_magnitude</span><span class="p">(</span><span class="n">grad_x</span><span class="p">,</span><span class="n">grad_y</span><span class="p">,</span><span class="n">grad_z</span><span class="p">)</span>
<span class="n">cubes_field</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">travelling_volume_average</span><span class="p">(</span><span class="n">grad_mag</span><span class="p">,</span><span class="n">cube</span><span class="p">,</span><span class="n">origin</span><span class="p">,</span><span class="n">vector</span><span class="p">,</span><span class="n">NGX</span><span class="p">,</span><span class="n">NGY</span><span class="p">,</span><span class="n">NGZ</span><span class="p">,</span><span class="n">magnitude</span><span class="p">)</span>
<span class="n">abscissa</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">vector_2_abscissa</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span><span class="n">magnitude</span><span class="p">,</span><span class="n">resolution_x</span><span class="p">,</span><span class="n">resolution_y</span><span class="p">,</span><span class="n">resolution_z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">abscissa</span><span class="p">,</span> <span class="n">cubes_field</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$z (\AA)$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;Potential (eV)&quot;</span><span class="p">,</span><span class="s2">&quot;Field Magnitude (eV/$\AA$))&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x12e2d96d0&gt;
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/89b5a50ffb4f658e0dc0248a88c888489dbf0eaaf5aea8f25b597235e9349d4e.png"><img alt="../_images/89b5a50ffb4f658e0dc0248a88c888489dbf0eaaf5aea8f25b597235e9349d4e.png" src="../_images/89b5a50ffb4f658e0dc0248a88c888489dbf0eaaf5aea8f25b597235e9349d4e.png" style="height: 300px;" /></a>
</div>
</div>
</section>
<section id="saving-the-data-into-a-csv-and-dat-binary-file">
<h3>Saving the data into a .csv and .dat (binary file)<a class="headerlink" href="#saving-the-data-into-a-csv-and-dat-binary-file" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Save the data to a file</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;ElectricField.csv&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span><span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;abscissa&#39;</span><span class="p">,</span> <span class="s1">&#39;cubes_field&#39;</span><span class="p">])</span> 
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">abscissa</span><span class="p">,</span> <span class="n">cubes_field</span><span class="p">):</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

<span class="n">temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;ElectricField.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>    
<span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">tofile</span><span class="p">(</span><span class="s1">&#39;ElectricField.dat&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="moving-cube">
<h2>Moving Cube<a class="headerlink" href="#moving-cube" title="Permalink to this heading">#</a></h2>
<p>Another notable function from <code class="docutils literal notranslate"><span class="pre">MacroDensiity</span></code> is the moving cube function. The code below generates an electrostatic potential plot that spans a specified vector across the unit cell. Inputs include cube size, origin, traversal vector, magnitude, input file, output data file name, and image file name. Outputs consist of an averaged electrostatic potential plot for the given cube size (as a list), a .csv file with the potential data, and a .png image displaying the potential plot.</p>
<p><img alt="" src="../_images/movingcube.gif" /></p>
<section id="id2">
<h3>Input section<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cube</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">origin</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.17</span><span class="p">]</span>
<span class="n">vector</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">magnitude</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">input_file</span> <span class="o">=</span> <span class="s1">&#39;LOCPOT.test&#39;</span>
<span class="n">output_file</span> <span class="o">=</span><span class="s1">&#39;MovingCube.csv&#39;</span>
<span class="n">img_file</span> <span class="o">=</span><span class="s1">&#39;MovingCube.png&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="getting-the-potential-values-along-a-vector">
<h3>Getting the potential values along a vector<a class="headerlink" href="#getting-the-potential-values-along-a-vector" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vasp_pot</span><span class="p">,</span> <span class="n">NGX</span><span class="p">,</span> <span class="n">NGY</span><span class="p">,</span> <span class="n">NGZ</span><span class="p">,</span> <span class="n">Lattice</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">read_vasp_density</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
<span class="n">vector_a</span><span class="p">,</span><span class="n">vector_b</span><span class="p">,</span><span class="n">vector_c</span><span class="p">,</span><span class="n">av</span><span class="p">,</span><span class="n">bv</span><span class="p">,</span><span class="n">cv</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">matrix_2_abc</span><span class="p">(</span><span class="n">Lattice</span><span class="p">)</span>
<span class="n">resolution_x</span> <span class="o">=</span> <span class="n">vector_a</span><span class="o">/</span><span class="n">NGX</span>
<span class="n">resolution_y</span> <span class="o">=</span> <span class="n">vector_b</span><span class="o">/</span><span class="n">NGY</span>
<span class="n">resolution_z</span> <span class="o">=</span> <span class="n">vector_c</span><span class="o">/</span><span class="n">NGZ</span>
<span class="n">grid_pot</span><span class="p">,</span> <span class="n">electrons</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">density_2_grid</span><span class="p">(</span><span class="n">vasp_pot</span><span class="p">,</span><span class="n">NGX</span><span class="p">,</span><span class="n">NGY</span><span class="p">,</span><span class="n">NGZ</span><span class="p">)</span>
<span class="n">cubes_potential</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">travelling_volume_average</span><span class="p">(</span><span class="n">grid_pot</span><span class="p">,</span><span class="n">cube</span><span class="p">,</span><span class="n">origin</span><span class="p">,</span><span class="n">vector</span><span class="p">,</span><span class="n">NGX</span><span class="p">,</span><span class="n">NGY</span><span class="p">,</span><span class="n">NGZ</span><span class="p">,</span><span class="n">magnitude</span><span class="p">)</span>
<span class="n">abscissa</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">vector_2_abscissa</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span><span class="n">magnitude</span><span class="p">,</span><span class="n">resolution_x</span><span class="p">,</span><span class="n">resolution_y</span><span class="p">,</span><span class="n">resolution_z</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plotting-and-saving-the-graph">
<h3>Plotting and Saving the graph<a class="headerlink" href="#plotting-and-saving-the-graph" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## PLOTTING</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">abscissa</span><span class="p">,</span> <span class="n">cubes_potential</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$z (\AA)$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Potential (V)&quot;</span><span class="p">)</span> <span class="c1">#(POINT: Fixed the axis title)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">img_file</span><span class="p">)</span>

<span class="c1">##SAVING</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s1">&#39;Potential&#39;</span><span class="p">:</span><span class="n">cubes_potential</span><span class="p">},</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reading header information...
Reading 3D data using Pandas...
Average of the potential =  -4.0478731477833207e-13
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/3bb87ca13fb858cf12837562446175c024e320bc59a0c34ff9cf47fba3f89574.png"><img alt="../_images/3bb87ca13fb858cf12837562446175c024e320bc59a0c34ff9cf47fba3f89574.png" src="../_images/3bb87ca13fb858cf12837562446175c024e320bc59a0c34ff9cf47fba3f89574.png" style="height: 300px;" /></a>
</div>
</div>
<p>## Plotting the Onsite (Hartree) Potential</p>
<p>The Hartree potential is the electrostatic potential from a given electron charge density. The code below is an example of how the package calculates and plots the onsite (Hartree) potential.</p>
</section>
<section id="imports-and-inputs">
<h3>Imports and Inputs<a class="headerlink" href="#imports-and-inputs" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">ase</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">ase.io</span> <span class="kn">import</span> <span class="n">write</span>
<span class="kn">from</span> <span class="nn">ase.io</span> <span class="kn">import</span> <span class="n">vasp</span>
<span class="kn">import</span> <span class="nn">macrodensity</span> <span class="k">as</span> <span class="nn">md</span>

<span class="c1">## INPUT SECTION</span>
<span class="n">potential_file</span> <span class="o">=</span> <span class="s1">&#39;LOCPOT.test&#39;</span>
<span class="n">coordinate_file</span> <span class="o">=</span> <span class="s1">&#39;POSCAR.test&#39;</span>
<span class="n">species</span> <span class="o">=</span> <span class="s2">&quot;Zn&quot;</span>
<span class="n">sample_cube</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="s1">&#39;OnSitePotential.csv&#39;</span>
<span class="n">img_file</span> <span class="o">=</span> <span class="s1">&#39;OnSitePotential.png&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="getting-and-calculating-potentials">
<h3>Getting and calculating potentials<a class="headerlink" href="#getting-and-calculating-potentials" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## GETTING POTENTIALS</span>
<span class="n">vasp_pot</span><span class="p">,</span> <span class="n">NGX</span><span class="p">,</span> <span class="n">NGY</span><span class="p">,</span> <span class="n">NGZ</span><span class="p">,</span> <span class="n">Lattice</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">read_vasp_density</span><span class="p">(</span><span class="n">potential_file</span><span class="p">)</span>
<span class="n">vector_a</span><span class="p">,</span><span class="n">vector_b</span><span class="p">,</span><span class="n">vector_c</span><span class="p">,</span><span class="n">av</span><span class="p">,</span><span class="n">bv</span><span class="p">,</span><span class="n">cv</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">matrix_2_abc</span><span class="p">(</span><span class="n">Lattice</span><span class="p">)</span>
<span class="n">resolution_x</span> <span class="o">=</span> <span class="n">vector_a</span><span class="o">/</span><span class="n">NGX</span>
<span class="n">resolution_y</span> <span class="o">=</span> <span class="n">vector_b</span><span class="o">/</span><span class="n">NGY</span>
<span class="n">resolution_z</span> <span class="o">=</span> <span class="n">vector_c</span><span class="o">/</span><span class="n">NGZ</span>
<span class="n">grid_pot</span><span class="p">,</span> <span class="n">electrons</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">density_2_grid</span><span class="p">(</span><span class="n">vasp_pot</span><span class="p">,</span><span class="n">NGX</span><span class="p">,</span><span class="n">NGY</span><span class="p">,</span><span class="n">NGZ</span><span class="p">)</span>
<span class="n">grad_x</span><span class="p">,</span><span class="n">grad_y</span><span class="p">,</span><span class="n">grad_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">grid_pot</span><span class="p">[:,:,:],</span><span class="n">resolution_x</span><span class="p">,</span><span class="n">resolution_y</span><span class="p">,</span><span class="n">resolution_z</span><span class="p">)</span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">ase</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">vasp</span><span class="o">.</span><span class="n">read_vasp</span><span class="p">(</span><span class="n">coordinate_file</span><span class="p">)</span>
<span class="n">scaled_coords</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">get_scaled_positions</span><span class="p">()</span>
<span class="n">symbols</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">get_chemical_symbols</span><span class="p">()</span>
<span class="n">ox_coords</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">symbols</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">species</span><span class="p">:</span>
        <span class="n">ox_coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scaled_coords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">grid_position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="n">potentials_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">num_bins</span> <span class="o">=</span> <span class="mi">20</span>
<span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">ox_coords</span><span class="p">:</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">grid_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">grid_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">grid_position</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">cube</span> <span class="o">=</span> <span class="n">sample_cube</span>
    <span class="n">origin</span> <span class="o">=</span> <span class="p">[</span><span class="n">grid_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">grid_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">grid_position</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">travelled</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cube_potential</span><span class="p">,</span> <span class="n">cube_var</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">volume_average</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span><span class="n">cube</span><span class="p">,</span><span class="n">grid_pot</span><span class="p">,</span><span class="n">NGX</span><span class="p">,</span><span class="n">NGY</span><span class="p">,</span><span class="n">NGZ</span><span class="p">)</span>
    <span class="n">potentials_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cube_potential</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reading header information...
Reading 3D data using Pandas...
Average of the potential =  -4.0478731477833207e-13
</pre></div>
</div>
</div>
</div>
</section>
<section id="plotting-and-saving-potentials">
<h3>Plotting and saving potentials<a class="headerlink" href="#plotting-and-saving-potentials" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## PLOTTING</span>
<span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">potentials_list</span><span class="p">,</span> <span class="n">num_bins</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#6400E1&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Hartree potential (V)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">% o</span><span class="s1">f centres&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">img_file</span><span class="p">)</span>

<span class="c1">## SAVING</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s1">&#39;Potential&#39;</span><span class="p">:</span><span class="n">potentials_list</span><span class="p">},</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/edcab59fe964a3e1dd680a3ef552233a5df28ab5451f20d163bc227ab3a033bf.png"><img alt="../_images/edcab59fe964a3e1dd680a3ef552233a5df28ab5451f20d163bc227ab3a033bf.png" src="../_images/edcab59fe964a3e1dd680a3ef552233a5df28ab5451f20d163bc227ab3a033bf.png" style="height: 300px;" /></a>
</div>
</div>
</section>
</section>
<section id="calculating-the-planar-average">
<h2>Calculating the Planar Average<a class="headerlink" href="#calculating-the-planar-average" title="Permalink to this heading">#</a></h2>
<p>The following code calculates planar and macroscopic averages of potential values from a given input file containing density data. It then plots the planar and macroscopic averages and saves both the plot and the calculated values in a CSV file.</p>
<section id="imports-and-input-section">
<h3>Imports and Input Section<a class="headerlink" href="#imports-and-input-section" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">macrodensity</span> <span class="k">as</span> <span class="nn">md</span>

<span class="c1">## INPUT SECTION</span>
<span class="n">input_file</span> <span class="o">=</span> <span class="s1">&#39;LOCPOT.test&#39;</span>
<span class="n">lattice_vector</span> <span class="o">=</span> <span class="mf">5.41</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="s1">&#39;PlanarAverage.csv&#39;</span>
<span class="n">img_file</span> <span class="o">=</span> <span class="s1">&#39;PlanarAverage.png&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="getting-potentials-from-vasp-file">
<h3>Getting Potentials from VASP file<a class="headerlink" href="#getting-potentials-from-vasp-file" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># GETTING POTENTIAL</span>
<span class="n">vasp_pot</span><span class="p">,</span> <span class="n">NGX</span><span class="p">,</span> <span class="n">NGY</span><span class="p">,</span> <span class="n">NGZ</span><span class="p">,</span> <span class="n">Lattice</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">read_vasp_density</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
<span class="n">vector_a</span><span class="p">,</span><span class="n">vector_b</span><span class="p">,</span><span class="n">vector_c</span><span class="p">,</span><span class="n">av</span><span class="p">,</span><span class="n">bv</span><span class="p">,</span><span class="n">cv</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">matrix_2_abc</span><span class="p">(</span><span class="n">Lattice</span><span class="p">)</span>
<span class="n">resolution_x</span> <span class="o">=</span> <span class="n">vector_a</span><span class="o">/</span><span class="n">NGX</span>
<span class="n">resolution_y</span> <span class="o">=</span> <span class="n">vector_b</span><span class="o">/</span><span class="n">NGY</span>
<span class="n">resolution_z</span> <span class="o">=</span> <span class="n">vector_c</span><span class="o">/</span><span class="n">NGZ</span>
<span class="n">grid_pot</span><span class="p">,</span> <span class="n">electrons</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">density_2_grid</span><span class="p">(</span><span class="n">vasp_pot</span><span class="p">,</span><span class="n">NGX</span><span class="p">,</span><span class="n">NGY</span><span class="p">,</span><span class="n">NGZ</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reading header information...
Reading 3D data using Pandas...
Average of the potential =  -4.0478731477833207e-13
</pre></div>
</div>
</div>
</div>
</section>
<section id="calculating-planar-and-macroscopic-average">
<h3>Calculating planar and macroscopic average<a class="headerlink" href="#calculating-planar-and-macroscopic-average" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## PLANAR AVERAGE</span>
<span class="n">planar</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">planar_average</span><span class="p">(</span><span class="n">grid_pot</span><span class="p">,</span><span class="n">NGX</span><span class="p">,</span><span class="n">NGY</span><span class="p">,</span><span class="n">NGZ</span><span class="p">)</span>

<span class="c1">## MACROSCOPIC AVERAGE</span>
<span class="n">macro</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">macroscopic_average</span><span class="p">(</span><span class="n">planar</span><span class="p">,</span><span class="n">lattice_vector</span><span class="p">,</span><span class="n">resolution_z</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Average of the average =  -0.07045532018119124
</pre></div>
</div>
</div>
</div>
</section>
<section id="plotting-and-saving">
<h3>Plotting and Saving<a class="headerlink" href="#plotting-and-saving" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## PLOTTING</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Voltage/V&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Grid Position&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">planar</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">macro</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">img_file</span><span class="p">)</span>

<span class="c1">## SAVING</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s1">&#39;Planar&#39;</span><span class="p">:</span><span class="n">planar</span><span class="p">,</span><span class="s1">&#39;Macroscopic&#39;</span><span class="p">:</span><span class="n">macro</span><span class="p">},</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/7f3dfcb6823e711130b3a216024b92c3ceca508bed28bf4b8a359dcab0d2ffe7.png"><img alt="../_images/7f3dfcb6823e711130b3a216024b92c3ceca508bed28bf4b8a359dcab0d2ffe7.png" src="../_images/7f3dfcb6823e711130b3a216024b92c3ceca508bed28bf4b8a359dcab0d2ffe7.png" style="height: 300px;" /></a>
</div>
</div>
</section>
</section>
<section id="calculating-the-planar-and-macroscopic-averages-from-a-cube-file">
<h2>Calculating the planar and macroscopic averages from a .cube file<a class="headerlink" href="#calculating-the-planar-and-macroscopic-averages-from-a-cube-file" title="Permalink to this heading">#</a></h2>
<p>The following code calculates planar and macroscopic averages for cube files containing potential density data. It reads the input cube file, processes the data, calculates the averages, plots the results, and saves both the plot and the calculated values in a CSV file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">ase.io.cube</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">macrodensity</span> <span class="k">as</span> <span class="nn">md</span>

<span class="c1">## INPUT SECTION</span>
<span class="n">input_file</span> <span class="o">=</span> <span class="s2">&quot;cube_001_spin_density.cube&quot;</span>
<span class="n">lattice_vector</span> <span class="o">=</span> <span class="mf">4.75</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="s1">&#39;PlanarCube.csv&#39;</span>
<span class="n">img_file</span> <span class="o">=</span> <span class="s1">&#39;PlanarCube.png&#39;</span>
</pre></div>
</div>
</div>
</div>
<section id="reading-potentials-from-cube-file">
<h3>Reading potentials from .cube file<a class="headerlink" href="#reading-potentials-from-cube-file" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># GETTING POTENTIAL</span>
<span class="n">potential</span><span class="p">,</span> <span class="n">atoms</span> <span class="o">=</span> <span class="n">ase</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">cube</span><span class="o">.</span><span class="n">read_cube_data</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
<span class="n">vector_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">vector_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">vector_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">NGX</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">potential</span><span class="p">)</span>
<span class="n">NGY</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">potential</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">NGZ</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">potential</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="n">resolution_x</span> <span class="o">=</span> <span class="n">vector_a</span><span class="o">/</span><span class="n">NGX</span>
<span class="n">resolution_y</span> <span class="o">=</span> <span class="n">vector_b</span><span class="o">/</span><span class="n">NGY</span>
<span class="n">resolution_z</span> <span class="o">=</span> <span class="n">vector_c</span><span class="o">/</span><span class="n">NGZ</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id3">
<h3>Calculating planar and macroscopic average<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## PLANAR AVERAGE</span>
<span class="n">planar</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">planar_average</span><span class="p">(</span><span class="n">potential</span><span class="p">,</span><span class="n">NGX</span><span class="p">,</span><span class="n">NGY</span><span class="p">,</span><span class="n">NGZ</span><span class="p">)</span>

<span class="c1">## MACROSCOPIC AVERAGE</span>
<span class="n">macro</span>  <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">macroscopic_average</span><span class="p">(</span><span class="n">planar</span><span class="p">,</span><span class="n">lattice_vector</span><span class="p">,</span><span class="n">resolution_z</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Average of the average =  0.004323820372140808
</pre></div>
</div>
</div>
</div>
</section>
<section id="id4">
<h3>Plotting and Saving<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## PLOTTING</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;V/V&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Grid Position&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">planar</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">macro</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">img_file</span><span class="p">)</span>

<span class="c1">## SAVING</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s1">&#39;Planar&#39;</span><span class="p">:</span><span class="n">planar</span><span class="p">,</span><span class="s1">&#39;Macroscopic&#39;</span><span class="p">:</span><span class="n">macro</span><span class="p">},</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/056accb7179630fb175d922c309935c54a5ba61a6c4db4499a23df8ab6d08b65.png"><img alt="../_images/056accb7179630fb175d922c309935c54a5ba61a6c4db4499a23df8ab6d08b65.png" src="../_images/056accb7179630fb175d922c309935c54a5ba61a6c4db4499a23df8ab6d08b65.png" style="height: 300px;" /></a>
</div>
</div>
</section>
</section>
<section id="calculating-the-spherical-average-around-a-given-point-in-a-material">
<h2>Calculating the Spherical Average around a given point in a material<a class="headerlink" href="#calculating-the-spherical-average-around-a-given-point-in-a-material" title="Permalink to this heading">#</a></h2>
<p>The code below calculates the spherical average of potential values within a specified cube around a given point using the macrodensity module. The script reads potential data from a VASP LOCPOT input file, extracts grid information, and calculates grid parameters. It then employs the md.volume_average function to compute the spherical average within the defined cube region, with the origin point and cube size provided. The resulting cube potential and cube variance values are printed in a formatted manner, returning the averaged potential distribution. This script is designed to facilitate the analysis of potential distributions within defined spatial regions.</p>
<section id="id5">
<h3>Input Section<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cube_size</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">cube_origin</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">]</span>
<span class="n">input_file</span> <span class="o">=</span> <span class="s1">&#39;LOCPOT.test&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="getting-potential-and-printing-the-potential-and-variance-values">
<h3>Getting potential and printing the potential and variance values<a class="headerlink" href="#getting-potential-and-printing-the-potential-and-variance-values" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## GETTING POTENTIAL</span>
<span class="n">vasp_pot</span><span class="p">,</span> <span class="n">NGX</span><span class="p">,</span> <span class="n">NGY</span><span class="p">,</span> <span class="n">NGZ</span><span class="p">,</span> <span class="n">Lattice</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">read_vasp_density</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
<span class="n">vector_a</span><span class="p">,</span><span class="n">vector_b</span><span class="p">,</span><span class="n">vector_c</span><span class="p">,</span><span class="n">av</span><span class="p">,</span><span class="n">bv</span><span class="p">,</span><span class="n">cv</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">matrix_2_abc</span><span class="p">(</span><span class="n">Lattice</span><span class="p">)</span>
<span class="n">resolution_x</span> <span class="o">=</span> <span class="n">vector_a</span><span class="o">/</span><span class="n">NGX</span>
<span class="n">resolution_y</span> <span class="o">=</span> <span class="n">vector_b</span><span class="o">/</span><span class="n">NGY</span>
<span class="n">resolution_z</span> <span class="o">=</span> <span class="n">vector_c</span><span class="o">/</span><span class="n">NGZ</span>
<span class="n">grid_pot</span><span class="p">,</span> <span class="n">electrons</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">density_2_grid</span><span class="p">(</span><span class="n">vasp_pot</span><span class="p">,</span><span class="n">NGX</span><span class="p">,</span><span class="n">NGY</span><span class="p">,</span><span class="n">NGZ</span><span class="p">)</span>

<span class="n">cube</span> <span class="o">=</span> <span class="n">cube_size</span>
<span class="n">origin</span> <span class="o">=</span> <span class="n">cube_origin</span>
<span class="n">travelled</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">cube_pot</span><span class="p">,</span> <span class="n">cube_var</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">volume_average</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="n">cube_origin</span><span class="p">,</span><span class="n">cube</span><span class="o">=</span><span class="n">cube_size</span><span class="p">,</span><span class="n">grid</span><span class="o">=</span><span class="n">grid_pot</span><span class="p">,</span><span class="n">nx</span><span class="o">=</span><span class="n">NGX</span><span class="p">,</span><span class="n">ny</span><span class="o">=</span><span class="n">NGY</span><span class="p">,</span><span class="n">nz</span><span class="o">=</span><span class="n">NGZ</span><span class="p">,</span><span class="n">travelled</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

<span class="c1">## PRINTING</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Potential            Variance&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cube_pot</span><span class="p">,</span><span class="s2">&quot;   &quot;</span><span class="p">,</span> <span class="n">cube_var</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reading header information...
Reading 3D data using Pandas...
Average of the potential =  -4.0478731477833207e-13
Potential            Variance
--------------------------------
6.5579496029375     1.8665165271901357e-05
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>


                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../tutorials.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Tutorials</p>
      </div>
    </a>
    <a class="right-next"
       href="HeteroJunction/HeteroJunction.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Heterojunction offsets</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-the-planar-and-macroscopic-average">Finding the planar and macroscopic average</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-the-potential">Get the potential</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-a-planar-average-field-potential-throughout-the-material">Plotting a planar average (Field/potential) throughout the material</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#distinguishing-plateau-regions-in-the-electrostatic-potential">Distinguishing plateau regions in the electrostatic potential</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#initialising-inputs">Initialising inputs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-potential-values">Getting potential values</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distinguishing-between-vaccuum-and-non-vaccuum-cubes">Distinguishing between vaccuum and non-vaccuum cubes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aligning-band-edged-to-reference-potentials">Aligning band edged to reference potentials</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#input-section">Input Section</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-potential-values-and-band-edges">Getting potential values and band edges</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-reference-states-and-the-aligned-band-energies">Calculating reference states and the aligned band energies</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-variation-of-potential-and-magnitude-of-electric-field">Plotting variation of potential and magnitude of electric field</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Initialising inputs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-the-potentials-and-field-magnitudes">Getting the potentials and field magnitudes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-the-data-into-a-csv-and-dat-binary-file">Saving the data into a .csv and .dat (binary file)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#moving-cube">Moving Cube</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Input section</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-the-potential-values-along-a-vector">Getting the potential values along a vector</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-and-saving-the-graph">Plotting and Saving the graph</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-and-inputs">Imports and Inputs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-and-calculating-potentials">Getting and calculating potentials</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-and-saving-potentials">Plotting and saving potentials</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-the-planar-average">Calculating the Planar Average</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-and-input-section">Imports and Input Section</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-potentials-from-vasp-file">Getting Potentials from VASP file</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-planar-and-macroscopic-average">Calculating planar and macroscopic average</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-and-saving">Plotting and Saving</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-the-planar-and-macroscopic-averages-from-a-cube-file">Calculating the planar and macroscopic averages from a .cube file</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-potentials-from-cube-file">Reading potentials from .cube file</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Calculating planar and macroscopic average</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Plotting and Saving</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-the-spherical-average-around-a-given-point-in-a-material">Calculating the Spherical Average around a given point in a material</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Input Section</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-potential-and-printing-the-potential-and-variance-values">Getting potential and printing the potential and variance values</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Keith T. Butler, Liam Harnett-Caulfield, Calysta Tesiman
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023, Walsh Materials Design Group.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>